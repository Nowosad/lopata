<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial patterns' search • motif</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Spatial patterns' search">
<meta property="og:description" content="motif">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">motif</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/cluster.html">Spatial patterns' clustering</a>
    </li>
    <li>
      <a href="../../articles/articles/compare.html">Spatial patterns' comparision</a>
    </li>
    <li>
      <a href="../../articles/articles/search.html">Spatial patterns' search</a>
    </li>
    <li>
      <a href="../../articles/articles/signatures.html">Signatures</a>
    </li>
    <li>
      <a href="../../articles/intro.html">Introduction to the motif package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Nowosad/motif/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatial patterns’ search</h1>
                        <h4 class="author">Jakub Nowosad</h4>
            
            <h4 class="date">2020-03-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Nowosad/motif/blob/master/vignettes/articles/search.Rmd"><code>vignettes/articles/search.Rmd</code></a></small>
      <div class="hidden name"><code>search.Rmd</code></div>

    </div>

    
    
<p>The pattern-based spatial analysis makes it possible to search for areas with similar spatial patterns. This vignette shows how to do spatial patterns’ search on example datasets. Let’s start by attaching neccesary packages:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">motif</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stars</span>)
<span class="co">#&gt; Loading required package: abind</span>
<span class="co">#&gt; Loading required package: sf</span>
<span class="co">#&gt; Linking to GEOS 3.8.1, GDAL 2.4.4, PROJ 7.0.0</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sf</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tmap</span>)</pre></body></html></div>
<p>Spatial patterns’ search requires having two spatial objects. The first one is the area of interest, and the second one is a larger area that we want to search in. For this vignette, we will read the <code>"raster/landcover2015.tif"</code> file, and crop our area of interest using coordinates of its borders.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">landcover</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stars/man/read_stars.html">read_stars</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"raster/landcover2015.tif"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"motif"</span>))

<span class="no">ext</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_bbox.html">st_bbox</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">xmin</span> <span class="kw">=</span> <span class="fl">238000</span>, <span class="kw">xmax</span> <span class="kw">=</span> <span class="fl">268000</span>,
                <span class="kw">ymin</span> <span class="kw">=</span> -<span class="fl">819814</span>, <span class="kw">ymax</span> <span class="kw">=</span> -<span class="fl">789814</span>),
                <span class="kw">crs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs</a></span>(<span class="no">landcover</span>))

<span class="no">landcover_ext</span> <span class="kw">=</span> <span class="no">landcover</span>[<span class="no">ext</span>]</pre></body></html></div>
<p>The <code>landcover_ext</code> represents area mostly covered by forest with some agriculture.</p>
<p><img src="search_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>We want to compare it to the land cover dataset of New Guinea - <code>landcover</code>.</p>
<p><img src="search_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<div id="regular-local-landscapes" class="section level3">
<h3 class="hasAnchor">
<a href="#regular-local-landscapes" class="anchor"></a>Regular local landscapes</h3>
<p>Spatial patterns’ search is done by the <code><a href="../../reference/lsp_search.html">lsp_search()</a></code> function. It expects an area of interest as the first object and the larger area as the second one. We should provide the type of signature (<code>type</code>) and the suitable distance function (<code>dist_fun</code>) we want to use to compare two datasets. Additional arguments include the size of the search window from the larger area (<code>window</code>) and how much of NA values we can accept in the local landscapes (<code>threshold</code>).</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">search_1</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/lsp_search.html">lsp_search</a></span>(<span class="no">landcover_ext</span>, <span class="no">landcover</span>,
                      <span class="kw">type</span> <span class="kw">=</span> <span class="st">"cove"</span>, <span class="kw">dist_fun</span> <span class="kw">=</span> <span class="st">"jensen-shannon"</span>,
                      <span class="kw">window</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="co">#&gt; Metric: 'jensen-shannon' using unit: 'log2'.</span>
<span class="no">search_1</span>
<span class="co">#&gt; stars object with 2 dimensions and 3 attributes</span>
<span class="co">#&gt; attribute(s):</span>
<span class="co">#&gt;       id             na_prop           dist          </span>
<span class="co">#&gt;  Min.   :   1.0   Min.   :0.0000   Min.   :0.000186  </span>
<span class="co">#&gt;  1st Qu.: 722.2   1st Qu.:0.0022   1st Qu.:0.053816  </span>
<span class="co">#&gt;  Median :1443.5   Median :1.0000   Median :0.500000  </span>
<span class="co">#&gt;  Mean   :1443.5   Mean   :0.6749   Mean   :0.335244  </span>
<span class="co">#&gt;  3rd Qu.:2164.8   3rd Qu.:1.0000   3rd Qu.:0.500000  </span>
<span class="co">#&gt;  Max.   :2886.0   Max.   :1.0000   Max.   :1.000000  </span>
<span class="co">#&gt; dimension(s):</span>
<span class="co">#&gt;   from to   offset  delta                       refsys point values    </span>
<span class="co">#&gt; x    1 74 -1091676  30000 PROJCS["unnamed",GEOGCS["...    NA   NULL [x]</span>
<span class="co">#&gt; y    1 39 -38556.5 -30000 PROJCS["unnamed",GEOGCS["...    NA   NULL [y]</span></pre></body></html></div>
<p>The result of the <code><a href="../../reference/lsp_search.html">lsp_search()</a></code> function is a <code>stars</code> object with three attributes: <code>id</code> - unique value for each local landscape, <code>na_prop</code> - proportion (0-1) of NA values in each local landscapes, and <code>dist</code> - the distance between our area of interest and each local landscape.</p>
<p>We can visualize the results, using for example the <strong>tmap</strong> package:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">my_breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">1.01</span>)
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span>(<span class="no">search_1</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span>(<span class="st">"dist"</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="no">my_breaks</span>, <span class="kw">palette</span> <span class="kw">=</span> <span class="st">"-viridis"</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span>(<span class="kw">legend.outside</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="search_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>It is now possible to see that there is one yellow area (it is almost the same as our area of interest), but also several yellowish areas that are similar to <code>landcover_ext</code>.</p>
<!-- SAMPLE VIZ -->
</div>
<div id="irregular-local-landscapes" class="section level3">
<h3 class="hasAnchor">
<a href="#irregular-local-landscapes" class="anchor"></a>Irregular local landscapes</h3>
<p>Search is also possible in irregular local landscapes, based on polygon data. <code>ecoregions.gpkg</code> contains terrestrial ecoregions for New Guinea from <a href="https://ecoregions2017.appspot.com/" class="uri">https://ecoregions2017.appspot.com/</a>.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">ecoregions</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_read.html">read_sf</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"vector/ecoregions.gpkg"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"motif"</span>))</pre></body></html></div>
<p><img src="search_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>The <code><a href="../../reference/lsp_search.html">lsp_search()</a></code> function works very similarly to the previous case - we just need to provide our ecoregions in the <code>window</code> argument.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">search_2</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/lsp_search.html">lsp_search</a></span>(<span class="no">landcover_ext</span>, <span class="no">landcover</span>,
                      <span class="kw">type</span> <span class="kw">=</span> <span class="st">"cove"</span>, <span class="kw">dist_fun</span> <span class="kw">=</span> <span class="st">"jensen-shannon"</span>,
                      <span class="kw">window</span> <span class="kw">=</span> <span class="no">ecoregions</span>[<span class="st">"id"</span>], <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="co">#&gt; Metric: 'jensen-shannon' using unit: 'log2'.</span>
<span class="no">search_2</span>
<span class="co">#&gt; stars object with 2 dimensions and 3 attributes</span>
<span class="co">#&gt; attribute(s), summary of first 1e+05 cells:</span>
<span class="co">#&gt;       id            na_prop          dist       </span>
<span class="co">#&gt;  Min.   :21      Min.   :0.01    Min.   :0.02   </span>
<span class="co">#&gt;  1st Qu.:21      1st Qu.:0.01    1st Qu.:0.02   </span>
<span class="co">#&gt;  Median :21      Median :0.01    Median :0.02   </span>
<span class="co">#&gt;  Mean   :21      Mean   :0.01    Mean   :0.02   </span>
<span class="co">#&gt;  3rd Qu.:21      3rd Qu.:0.01    3rd Qu.:0.02   </span>
<span class="co">#&gt;  Max.   :21      Max.   :0.01    Max.   :0.02   </span>
<span class="co">#&gt;  NA's   :98383   NA's   :98383   NA's   :98383  </span>
<span class="co">#&gt; dimension(s):</span>
<span class="co">#&gt;   from   to   offset delta                       refsys point values    </span>
<span class="co">#&gt; x    1 7360 -1091676   300 PROJCS["unnamed",GEOGCS["... FALSE   NULL [x]</span>
<span class="co">#&gt; y    1 3812 -38556.5  -300 PROJCS["unnamed",GEOGCS["... FALSE   NULL [y]</span></pre></body></html></div>
<p>Let’s vizualize the output:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">my_breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">1.01</span>)
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span>(<span class="no">search_2</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span>(<span class="st">"dist"</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="no">my_breaks</span>, <span class="kw">palette</span> <span class="kw">=</span> <span class="st">"-viridis"</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span>(<span class="no">ecoregions</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span>(<span class="kw">col</span> <span class="kw">=</span> <span class="st">"black"</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span>(<span class="kw">legend.outside</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="search_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>This search shows that most of the polygons are fairly different from our area of interest. Only one of them has a relatively small distance of about 0.007.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">search_2</span>$<span class="no">dist</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; [1] 0.006851394</span></pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">search_2</span>$<span class="no">id</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">search_2</span>$<span class="no">dist</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">search_2</span>$<span class="no">dist</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>))])
<span class="co">#&gt; [1] 10</span></pre></body></html></div>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">landcover_mindist2</span> <span class="kw">=</span> <span class="no">landcover</span>[<span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">ecoregions</span>, <span class="no">id</span> <span class="kw">==</span> <span class="fl">10</span>)]</pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">landcover_mindist2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="no">landcover_mindist2</span>)
<span class="fu"><a href="https://rdrr.io/pkg/stars/man/plot.html">plot</a></span>(<span class="no">landcover_mindist2</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="kw">NULL</span>)</pre></body></html></div>
<p><img src="search_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jakub Nowosad.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
